<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

        <meta name="author" content="Tao Wu" />
        <meta name="author" content="Chenxu Wu" />
        <meta name="author" content="Xue-Song Liu (Corresponding author)" />
    
        <meta name="date" content="2021-08-17" />
    
    <title>Extrachromosomal DNA is associated with decreased immune cell infiltration and antigen presentation, represents a potential cancer immune evasion mechanism</title>

        <script src="analysis_files/header-attrs-2.6/header-attrs.js"></script>
        <script src="analysis_files/jquery-1.11.3/jquery.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="analysis_files/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="analysis_files/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="analysis_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
        <script src="analysis_files/navigation-1.1/tabsets.js"></script>
        <link href="analysis_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
        <script src="analysis_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
        <link href="analysis_files/readthedown-0.1/readthedown.css" rel="stylesheet" />
        <link href="analysis_files/readthedown-0.1/readthedown_fonts_embed.css" rel="stylesheet" />
        <script src="analysis_files/readthedown-0.1/readthedown.js"></script>
    
    
        <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          background-color: #ffffff;
          color: #a0a0a0;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
      div.sourceCode
        { color: #1f1c1b; background-color: #ffffff; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span { color: #1f1c1b; } /* Normal */
      code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
      code span.an { color: #ca60ca; } /* Annotation */
      code span.at { color: #0057ae; } /* Attribute */
      code span.bn { color: #b08000; } /* BaseN */
      code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
      code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #924c9d; } /* Char */
      code span.cn { color: #aa5500; } /* Constant */
      code span.co { color: #898887; } /* Comment */
      code span.cv { color: #0095ff; } /* CommentVar */
      code span.do { color: #607880; } /* Documentation */
      code span.dt { color: #0057ae; } /* DataType */
      code span.dv { color: #b08000; } /* DecVal */
      code span.er { color: #bf0303; text-decoration: underline; } /* Error */
      code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
      code span.fl { color: #b08000; } /* Float */
      code span.fu { color: #644a9b; } /* Function */
      code span.im { color: #ff5500; } /* Import */
      code span.in { color: #b08000; } /* Information */
      code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
      code span.op { color: #1f1c1b; } /* Operator */
      code span.ot { color: #006e28; } /* Other */
      code span.pp { color: #006e28; } /* Preprocessor */
      code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
      code span.sc { color: #3daee9; } /* SpecialChar */
      code span.ss { color: #ff5500; } /* SpecialString */
      code span.st { color: #bf0303; } /* String */
      code span.va { color: #0057ae; } /* Variable */
      code span.vs { color: #bf0303; } /* VerbatimString */
      code span.wa { color: #bf0303; } /* Warning */
    </style>
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
         <!-- readthedown start -->   
   <div id="content" data-toggle="wy-nav-shift">
     <nav id="nav-top" role="navigation" aria-label="top navigation">
       <a role="button" href="#" data-toggle="wy-nav-top"><span class="glyphicon glyphicon-menu-hamburger"></span></a>
     </nav>
         
   
        
      <h1 class="title">Extrachromosomal DNA is associated with decreased immune cell infiltration and antigen presentation, represents a potential cancer immune evasion mechanism</h1>
      
         <!-- readthedown authors -->
   <div id="sidebar">
    <h2><a href="#content">Extrachromosomal DNA is associated with decreased immune cell infiltration and antigen presentation, represents a potential cancer immune evasion mechanism</a></h2>
    <div id="toc">
      <ul>
      <li><a href="#sample-distribution">Sample Distribution</a></li>
      <li><a href="#immune-cell-infiltration-status">Immune cell infiltration status</a></li>
      <li><a href="#ecdna-and-tumor-immune-typing">EcDNA and tumor immune typing</a></li>
      <li><a href="#ecdna-and-tumor-immune-escape">EcDNA and tumor immune escape</a></li>
      <li><a href="#potential-mechanistic-study">Potential mechanistic study</a></li>
      </ul>
    </div>
    <div id="postamble" data-toggle="wy-nav-shift" class="status">
                  <p class="author"><span class="glyphicon glyphicon-user"></span> Tao Wu</p>
                        <p class="author"><span class="glyphicon glyphicon-user"></span> Chenxu Wu</p>
                        <p class="author"><span class="glyphicon glyphicon-user"></span> Xue-Song Liu (Corresponding author)</p>
                        <p class="date"><span class="glyphicon glyphicon-calendar"></span> 2021-08-17</p>
          </div>
   </div>
     

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div id="main">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NeoEnrichment)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggprism)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code></pre></div>
<div id="sample-distribution" class="section level2">
<h2>Sample Distribution</h2>
<p>EcDNA status information was determined using AmpliconArchitect from WGS data as described previously (Kim et al., 2020). Gene expression data are available for the majority of TCGA but not PCAWG datasets. So for downstream immune infiltration and gene expression analysis, we only keep TCGA samples.</p>
<p>We first look at the ecDNA status distribution of samples:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;../data/Extrachromosomal DNA is associated with oncogene amplification and poor outcome across multiple cancers.xlsx&quot;</span>,<span class="at">sheet =</span> <span class="dv">3</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">##keep TCGA samples</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tumor_or_normal<span class="sc">!=</span><span class="st">&quot;normal&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;TCGA&quot;</span>,sample_barcode))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ecDNA=</span><span class="fu">ifelse</span>(<span class="fu">any</span>(sample_classification<span class="sc">==</span><span class="st">&quot;Circular&quot;</span>),<span class="st">&quot;yes&quot;</span>,<span class="st">&quot;no&quot;</span>))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">get_cancer_type</span>(dt<span class="sc">$</span>sample_barcode)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_sample=</span><span class="fu">n</span>(),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ecDNA_postive=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="ot">-&gt;</span> summ</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>summ <span class="ot">&lt;-</span> summ <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(total_sample))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>summ <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;total_sample&quot;</span>,<span class="st">&quot;ecDNA_postive&quot;</span>),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">&quot;type&quot;</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="ot">-&gt;</span> summ2</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>summ2<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">factor</span>(summ2<span class="sc">$</span>cancer,<span class="at">levels =</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>summ2,<span class="fu">aes</span>(<span class="at">x=</span>cancer,<span class="at">y=</span>counts,<span class="at">fill=</span>type))<span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-2-1.png" width="2400" /></p>
<p>And when combined with RNA expression data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tpm_gene_log2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/tpm_gene_log2.rds&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dt_exp <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sample_barcode <span class="sc">%in%</span> <span class="fu">colnames</span>(tpm_gene_log2))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>dt_exp <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_sample=</span><span class="fu">n</span>(),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ecDNA_postive=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="ot">-&gt;</span> summ</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>summ <span class="ot">&lt;-</span> summ <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(total_sample))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>summ <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;total_sample&quot;</span>,<span class="st">&quot;ecDNA_postive&quot;</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">&quot;type&quot;</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="ot">-&gt;</span> summ2</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>summ2<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">factor</span>(summ2<span class="sc">$</span>cancer,<span class="at">levels =</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>summ2,<span class="fu">aes</span>(<span class="at">x=</span>cancer,<span class="at">y=</span>counts,<span class="at">fill=</span>type))<span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-3-1.png" width="2400" /></p>
</div>
<div id="immune-cell-infiltration-status" class="section level2">
<h2>Immune cell infiltration status</h2>
<p>We used various methods to compare immune infiltration status between samples with and without ecDNA. We first check the total immune infiltration levels quantified by ESTIMATE, Xcell immune score and Leukocyte fraction.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">##ESTIMATE</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pancancer_estimate_score <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pancancer_estimate_score.rds&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dt_immune1 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  pancancer_estimate_score)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>dt_immune1 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>dt_immune1 <span class="ot">&lt;-</span> dt_immune1 <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">###MCPcounter cytotoxicity score and Xcell immune score</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>immune <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;../data/infiltration_estimation_for_tcga.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sample=</span>cell_type) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sample,<span class="st">`</span><span class="at">cytotoxicity score_MCPCOUNTER</span><span class="st">`</span>,<span class="st">`</span><span class="at">immune score_XCELL</span><span class="st">`</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>dt_immune2 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  immune)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>dt_immune2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>),<span class="at">a_c=</span><span class="fu">n</span>(),<span class="at">per=</span>c<span class="sc">/</span>a_c) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>dt_immune2 <span class="ot">&lt;-</span> dt_immune2 <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Leukocyte fraction</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>immune_landscape <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/immune_landscape.rds&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>dt_immune3 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">substr</span>(sample,<span class="dv">1</span>,<span class="dv">12</span>)),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  immune_landscape <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">TCGA Participant Barcode</span><span class="st">`</span>,<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>,<span class="st">`</span><span class="at">Leukocyte Fraction</span><span class="st">`</span>,<span class="st">`</span><span class="at">Intratumor Heterogeneity</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">sample=</span><span class="st">`</span><span class="at">TCGA Participant Barcode</span><span class="st">`</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Leukocyte Fraction</span><span class="st">`</span>))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dt_immune3 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>),<span class="at">a_c=</span><span class="fu">n</span>(),<span class="at">per=</span>c<span class="sc">/</span>a_c) <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>dt_immune3 <span class="ot">&lt;-</span> dt_immune3 <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_immune1,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>ImmuneScore))<span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;ImmuneScore (Estimate)&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_immune2,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span><span class="fu">log</span>(<span class="st">`</span><span class="at">cytotoxicity score_MCPCOUNTER</span><span class="st">`</span><span class="sc">+</span><span class="dv">1</span>)))<span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Cytotoxicity score (MCPCOUNTER)&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_immune2,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span><span class="st">`</span><span class="at">immune score_XCELL</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Immune score (XCELL)&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_immune3,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span><span class="st">`</span><span class="at">Leukocyte Fraction</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p3 <span class="sc">+</span> p4  <span class="sc">+</span> p2<span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-7-1.png" width="3000" style="display: block; margin: auto;" /></p>
<p>With different methods, tumors with ecDNA consistently show significantly decreased immune scores.</p>
<p>We also calculated other infiltration scores including IPS Z-score, CYT and TIS:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>IPS <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/IPS.rds&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dt_IPS <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  IPS)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>dt_IPS <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>dt_IPS <span class="ot">&lt;-</span> dt_IPS <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_IPS,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>AZ))<span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;IPS Z-score&quot;</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>tis <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../data/tis_signature.txt&quot;</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>tis<span class="sc">$</span>sample <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tis)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>dt_tis <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  tis)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>dt_tis <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>dt_tis <span class="ot">&lt;-</span> dt_tis <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_tis,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>V1))<span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;TIS&quot;</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>cyts <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/cyts.rds&quot;</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>dt_cyts <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  cyts)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>dt_cyts <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>dt_cyts <span class="ot">&lt;-</span> dt_cyts <span class="sc">%&gt;%</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_cyts,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>cyts))<span class="sc">+</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;CYT&quot;</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>p5 <span class="sc">+</span> p6 <span class="sc">+</span> p7</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-8-1.png" width="3900" style="display: block; margin: auto;" /></p>
<p>Then we look close into the difference of different immune cell types between samples with and without ecDNA using above methods:</p>
</div>
<div id="ecdna-and-tumor-immune-typing" class="section level2">
<h2>EcDNA and tumor immune typing</h2>
<p>Recently, several studies have classified cancers into different immune subtypes and found each subtype related to specific microenvironment. Here we used Chisq-square test to check the association between ecDNA status and immune subtypes. We used two classification methods: 1) Pan-cancer immunogenomic analysis has classified cancer into six immune subtypes—wound healing, IFN-γ dominant, inflammatory, lymphocyte depleted, immunologically quiet, and TGF-β dominant (Thorsson et al., 2018), 2) The TME has been classified into 4 types according to the expression of immune and stromal related genes (Bagaev et al., 2021).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>summ <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>dt_filter <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../data/annotation-tcga.tsv&quot;</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">header =</span> T)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>dt_anno <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  dt_filter <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">substr</span>(sample,<span class="dv">1</span>,<span class="dv">12</span>)),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  anno <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(X,MFP) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">sample=</span>X)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="fu">table</span>(dt_anno<span class="sc">$</span>ecDNA,dt_anno<span class="sc">$</span>MFP))</span></code></pre></div>
<pre><code>#&gt; 
#&gt;  Pearson&#39;s Chi-squared test
#&gt; 
#&gt; data:  table(dt_anno$ecDNA, dt_anno$MFP)
#&gt; X-squared = 14.142, df = 3, p-value = 0.002718</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dt_anno <span class="ot">&lt;-</span> dt_anno <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ecDNA,MFP) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">counts=</span><span class="fu">n</span>())</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_anno,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>counts,<span class="at">fill=</span>MFP))<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,<span class="at">position=</span><span class="st">&quot;fill&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Percent of cases (%)&quot;</span>,<span class="at">title =</span> <span class="st">&quot;Chi-squared test, P = 0.002718&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>immune_landscape <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/immune_landscape.rds&quot;</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>dt_immune <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  dt_filter <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">substr</span>(sample,<span class="dv">1</span>,<span class="dv">12</span>)),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  immune_landscape <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">TCGA Participant Barcode</span><span class="st">`</span>,<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>,<span class="st">`</span><span class="at">Leukocyte Fraction</span><span class="st">`</span>,<span class="st">`</span><span class="at">Intratumor Heterogeneity</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">sample=</span><span class="st">`</span><span class="at">TCGA Participant Barcode</span><span class="st">`</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>dt_subtype <span class="ot">&lt;-</span> dt_immune <span class="sc">%&gt;%</span> <span class="fu">select</span>(sample,ecDNA,<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>,cancer) <span class="sc">%&gt;%</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>))</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>dt_subtype<span class="sc">$</span><span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dt_subtype<span class="sc">$</span><span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="fu">table</span>(dt_subtype<span class="sc">$</span>ecDNA,dt_subtype<span class="sc">$</span><span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>))</span></code></pre></div>
<pre><code>#&gt; 
#&gt;  Pearson&#39;s Chi-squared test
#&gt; 
#&gt; data:  table(dt_subtype$ecDNA, dt_subtype$`Immune Subtype`)
#&gt; X-squared = 25.383, df = 4, p-value = 4.212e-05</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dt_subtype <span class="ot">&lt;-</span> dt_subtype <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ecDNA,<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">counts=</span><span class="fu">n</span>())</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>p9 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_subtype,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>counts,<span class="at">fill=</span><span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,<span class="at">position=</span><span class="st">&quot;fill&quot;</span>)<span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Percent of cases (%)&quot;</span>,<span class="at">title =</span> <span class="st">&quot;Chi-squared test, P = 4.212e-05&quot;</span>)<span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;#FE0000&quot;</span>,<span class="st">&quot;#FEFB04&quot;</span>,<span class="st">&quot;#13FC00&quot;</span>,<span class="st">&quot;#00FDFE&quot;</span>,<span class="st">&quot;#FC2AFD&quot;</span>))<span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>p8 <span class="sc">+</span> p9</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-10-1.png" width="2400" /></p>
<p>In tumors with ecDNA, C4 (lymphocyte depleted) type TME is up-regulated, while C3 (inflammatory) and C6 (TGF-β dominant) types are down-regulated and immune-enriched, fibrotic (IE/F) type of TME is dramatically decreased, while immune desert type TME is significantly up-regulated.</p>
</div>
<div id="ecdna-and-tumor-immune-escape" class="section level2">
<h2>EcDNA and tumor immune escape</h2>
<p>We next checked the expression difference of immune inhibitory immune checkpoint genes, such as PD-L1, CTLA4 between samples with and without ecDNA:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>checkpoint <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ADORA2A&quot;</span>, <span class="st">&quot;CD276&quot;</span>, <span class="st">&quot;VTCN1&quot;</span>, <span class="st">&quot;BTLA&quot;</span>, <span class="st">&quot;CTLA4&quot;</span>, <span class="st">&quot;IDO1&quot;</span>,<span class="st">&quot;LAG3&quot;</span>,<span class="st">&quot;CYBB&quot;</span>,<span class="st">&quot;PDCD1&quot;</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;HAVCR2&quot;</span>,<span class="st">&quot;C10orf54&quot;</span>,<span class="st">&quot;SIGLEC7&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>tpm_gene_log2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/tpm_gene_log2.rds&quot;</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>tpm_gene_log2 <span class="ot">&lt;-</span> tpm_gene_log2[<span class="sc">!</span><span class="fu">duplicated</span>(tpm_gene_log2<span class="sc">$</span>gene),]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene_log2 <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gene <span class="sc">%in%</span> checkpoint) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gene,<span class="fu">any_of</span>(dt<span class="sc">$</span>sample_barcode))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tpm_gene) <span class="ot">&lt;-</span> tpm_gene<span class="sc">$</span>gene</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>gene)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> <span class="fu">t</span>(tpm_gene) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>sample <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tpm_gene)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">get_cancer_type</span>(tpm_gene<span class="sc">$</span>sample)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(tpm_gene,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                       dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode))</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ecdna_c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="ot">-&gt;</span> tpm_summ</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>tpm_summ <span class="ot">&lt;-</span> tpm_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ecdna_c<span class="sc">&gt;</span><span class="dv">20</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> tpm_summ<span class="sc">$</span>cancer)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>   tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">&quot;LAG3&quot;</span><span class="sc">:</span><span class="st">&quot;PDCD1&quot;</span>,<span class="at">names_to =</span> <span class="st">&quot;gene&quot;</span>,<span class="at">values_to =</span> <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>exp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(tpm_dt<span class="sc">$</span>exp)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_dt <span class="sc">%&gt;%</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ecDNA =</span> <span class="fu">ifelse</span>(ecDNA <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>,<span class="st">&quot;Non-ecDNA&quot;</span>))</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">factor</span>(tpm_dt<span class="sc">$</span>ecDNA,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>tpm_dt,<span class="fu">aes</span>(<span class="at">x=</span>gene,<span class="at">y=</span>exp,<span class="at">fill=</span>ecDNA))<span class="sc">+</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;log2(TPM + 0.001)&quot;</span>)<span class="sc">+</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-11-1.png" width="3000" style="display: block; margin: auto;" /></p>
<p>Then we checked the cancer type specific checkpoint expression difference, heatmap color indicates median difference of expression for specific gene in specific cancer type between ecDNA and non-ecDNA samples:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">12</span><span class="sc">*</span><span class="dv">7</span>),<span class="at">nrow =</span> <span class="dv">12</span>,<span class="at">ncol =</span> <span class="dv">7</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">unique</span>(tpm_gene<span class="sc">$</span>cancer)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mat)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>mat<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(tpm_dt<span class="sc">$</span>gene)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(mat)[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(mat)<span class="sc">-</span><span class="dv">1</span>)]){</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> mat<span class="sc">$</span>gene){</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(j,cancer,ecDNA) <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(cancer <span class="sc">==</span> i)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;tt&quot;</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>tt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>tt)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    mat[mat<span class="sc">$</span>gene <span class="sc">==</span> j,i] <span class="ot">&lt;-</span> <span class="fu">median</span>(df[df<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>,<span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">median</span>(df[df<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;no&quot;</span>,<span class="dv">1</span>])</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> mat<span class="sc">$</span>gene</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> mat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>gene)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(circlize)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>col_fun <span class="ot">=</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(mat,<span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,<span class="at">name =</span> <span class="st">&quot; &quot;</span>,<span class="at">col =</span> col_fun)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-12-1.png" width="2400" /></p>
<p>These checkpoints are generally down-regulated, and this could also implicates that immune checkpoint inhibitor therapy alone may not work in tumors with ecDNA.</p>
</div>
<div id="potential-mechanistic-study" class="section level2">
<h2>Potential mechanistic study</h2>
</div>
</div>

   
   
            
      

  <script>
    $(document).ready(function () {

			
 		
	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
