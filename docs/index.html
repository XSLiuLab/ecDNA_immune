<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

        <meta name="author" content="Tao Wu" />
        <meta name="author" content="Chenxu Wu" />
        <meta name="author" content="Xue-Song Liu (Corresponding author)" />
    
        <meta name="date" content="2021-08-17" />
    
    <title>Extrachromosomal DNA is associated with decreased immune cell infiltration and antigen presentation, represents a potential cancer immune evasion mechanism</title>

        <script src="analysis_files/header-attrs-2.6/header-attrs.js"></script>
        <script src="analysis_files/jquery-1.11.3/jquery.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="analysis_files/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="analysis_files/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="analysis_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
        <script src="analysis_files/navigation-1.1/tabsets.js"></script>
        <link href="analysis_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
        <script src="analysis_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
        <link href="analysis_files/readthedown-0.1/readthedown.css" rel="stylesheet" />
        <link href="analysis_files/readthedown-0.1/readthedown_fonts_embed.css" rel="stylesheet" />
        <script src="analysis_files/readthedown-0.1/readthedown.js"></script>
    
    
        <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          background-color: #ffffff;
          color: #a0a0a0;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
      div.sourceCode
        { color: #1f1c1b; background-color: #ffffff; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span { color: #1f1c1b; } /* Normal */
      code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
      code span.an { color: #ca60ca; } /* Annotation */
      code span.at { color: #0057ae; } /* Attribute */
      code span.bn { color: #b08000; } /* BaseN */
      code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
      code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #924c9d; } /* Char */
      code span.cn { color: #aa5500; } /* Constant */
      code span.co { color: #898887; } /* Comment */
      code span.cv { color: #0095ff; } /* CommentVar */
      code span.do { color: #607880; } /* Documentation */
      code span.dt { color: #0057ae; } /* DataType */
      code span.dv { color: #b08000; } /* DecVal */
      code span.er { color: #bf0303; text-decoration: underline; } /* Error */
      code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
      code span.fl { color: #b08000; } /* Float */
      code span.fu { color: #644a9b; } /* Function */
      code span.im { color: #ff5500; } /* Import */
      code span.in { color: #b08000; } /* Information */
      code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
      code span.op { color: #1f1c1b; } /* Operator */
      code span.ot { color: #006e28; } /* Other */
      code span.pp { color: #006e28; } /* Preprocessor */
      code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
      code span.sc { color: #3daee9; } /* SpecialChar */
      code span.ss { color: #ff5500; } /* SpecialString */
      code span.st { color: #bf0303; } /* String */
      code span.va { color: #0057ae; } /* Variable */
      code span.vs { color: #bf0303; } /* VerbatimString */
      code span.wa { color: #bf0303; } /* Warning */
    </style>
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
         <!-- readthedown start -->   
   <div id="content" data-toggle="wy-nav-shift">
     <nav id="nav-top" role="navigation" aria-label="top navigation">
       <a role="button" href="#" data-toggle="wy-nav-top"><span class="glyphicon glyphicon-menu-hamburger"></span></a>
     </nav>
         
   
        
      <h1 class="title">Extrachromosomal DNA is associated with decreased immune cell infiltration and antigen presentation, represents a potential cancer immune evasion mechanism</h1>
      
         <!-- readthedown authors -->
   <div id="sidebar">
    <h2><a href="#content">Extrachromosomal DNA is associated with decreased immune cell infiltration and antigen presentation, represents a potential cancer immune evasion mechanism</a></h2>
    <div id="toc">
      <ul>
      <li><a href="#sample-distribution">Sample Distribution</a></li>
      <li><a href="#immune-cell-infiltration-status">Immune cell infiltration status</a></li>
      <li><a href="#ecdna-and-tumor-immune-typing">EcDNA and tumor immune typing</a></li>
      <li><a href="#ecdna-and-tumor-immune-escape">EcDNA and tumor immune escape</a></li>
      <li><a href="#potential-mechanistic-study">Potential mechanistic study</a></li>
      </ul>
    </div>
    <div id="postamble" data-toggle="wy-nav-shift" class="status">
                  <p class="author"><span class="glyphicon glyphicon-user"></span> Tao Wu</p>
                        <p class="author"><span class="glyphicon glyphicon-user"></span> Chenxu Wu</p>
                        <p class="author"><span class="glyphicon glyphicon-user"></span> Xue-Song Liu (Corresponding author)</p>
                        <p class="date"><span class="glyphicon glyphicon-calendar"></span> 2021-08-17</p>
          </div>
   </div>
     

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div id="main">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NeoEnrichment)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggprism)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div>
<div id="sample-distribution" class="section level2">
<h2>Sample Distribution</h2>
<p>EcDNA status information was determined using AmpliconArchitect from WGS data as described previously (Kim et al., 2020). Gene expression data are available for the majority of TCGA but not PCAWG datasets. So for downstream immune infiltration and gene expression analysis, we only keep TCGA samples.</p>
<p>We first look at the ecDNA status distribution of samples:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">##keep TCGA samples</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;../data/Extrachromosomal DNA is associated with oncogene amplification and poor outcome across multiple cancers.xlsx&quot;</span>,<span class="at">sheet =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tumor_or_normal<span class="sc">!=</span><span class="st">&quot;normal&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;TCGA&quot;</span>,sample_barcode)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ecDNA=</span><span class="fu">ifelse</span>(<span class="fu">any</span>(sample_classification<span class="sc">==</span><span class="st">&quot;Circular&quot;</span>),<span class="st">&quot;yes&quot;</span>,<span class="st">&quot;no&quot;</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">get_cancer_type</span>(dt<span class="sc">$</span>sample_barcode)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_sample=</span><span class="fu">n</span>(),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">ecDNA_postive=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(total_sample)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;total_sample&quot;</span>,<span class="st">&quot;ecDNA_postive&quot;</span>),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;type&quot;</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="ot">-&gt;</span> summ</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>summ<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">factor</span>(summ<span class="sc">$</span>cancer,<span class="at">levels =</span> <span class="fu">unique</span>(summ<span class="sc">$</span>cancer))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>summ,<span class="fu">aes</span>(<span class="at">x=</span>cancer,<span class="at">y=</span>counts,<span class="at">fill=</span>type))<span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-2-1.png" width="2400" /></p>
<p>And when combined with RNA expression data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tpm_gene_log2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../../tmp/tpm_gene_log2.rds&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dt_exp <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sample_barcode <span class="sc">%in%</span> <span class="fu">colnames</span>(tpm_gene_log2))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>dt_exp <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_sample=</span><span class="fu">n</span>(),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ecDNA_postive=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_sample)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;total_sample&quot;</span>,<span class="st">&quot;ecDNA_postive&quot;</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">&quot;type&quot;</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="ot">-&gt;</span> summ</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>summ<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">factor</span>(summ<span class="sc">$</span>cancer,<span class="at">levels =</span> <span class="fu">unique</span>(summ<span class="sc">$</span>cancer))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>summ,<span class="fu">aes</span>(<span class="at">x=</span>cancer,<span class="at">y=</span>counts,<span class="at">fill=</span>type))<span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-3-1.png" width="2400" /></p>
</div>
<div id="immune-cell-infiltration-status" class="section level2">
<h2>Immune cell infiltration status</h2>
<p>We used various methods to compare immune infiltration status between samples with and without ecDNA. We first check the total immune infiltration levels quantified by ESTIMATE, Xcell immune score and Leukocyte fraction.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">##ESTIMATE</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pancancer_estimate_score <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pancancer_estimate_score.rds&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dt_immune1 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  pancancer_estimate_score)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>dt_immune1 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>dt_immune1 <span class="ot">&lt;-</span> dt_immune1 <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">###MCPcounter cytotoxicity score and Xcell immune score</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>immune <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;../data/infiltration_estimation_for_tcga.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sample=</span>cell_type) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sample,<span class="st">`</span><span class="at">cytotoxicity score_MCPCOUNTER</span><span class="st">`</span>,<span class="st">`</span><span class="at">immune score_XCELL</span><span class="st">`</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>dt_immune2 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  immune)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>dt_immune2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>),<span class="at">a_c=</span><span class="fu">n</span>(),<span class="at">per=</span>c<span class="sc">/</span>a_c) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>dt_immune2 <span class="ot">&lt;-</span> dt_immune2 <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Leukocyte fraction</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>immune_landscape <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/immune_landscape.rds&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>dt_immune3 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">substr</span>(sample,<span class="dv">1</span>,<span class="dv">12</span>)),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  immune_landscape <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">TCGA Participant Barcode</span><span class="st">`</span>,<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>,<span class="st">`</span><span class="at">Leukocyte Fraction</span><span class="st">`</span>,<span class="st">`</span><span class="at">Intratumor Heterogeneity</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">sample=</span><span class="st">`</span><span class="at">TCGA Participant Barcode</span><span class="st">`</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Leukocyte Fraction</span><span class="st">`</span>))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dt_immune3 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>),<span class="at">a_c=</span><span class="fu">n</span>(),<span class="at">per=</span>c<span class="sc">/</span>a_c) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>dt_immune3 <span class="ot">&lt;-</span> dt_immune3 <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_immune1,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>ImmuneScore))<span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;ImmuneScore (Estimate)&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_immune2,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span><span class="fu">log</span>(<span class="st">`</span><span class="at">cytotoxicity score_MCPCOUNTER</span><span class="st">`</span><span class="sc">+</span><span class="dv">1</span>)))<span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Cytotoxicity score (MCPCOUNTER)&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_immune2,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span><span class="st">`</span><span class="at">immune score_XCELL</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Immune score (XCELL)&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_immune3,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span><span class="st">`</span><span class="at">Leukocyte Fraction</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p3 <span class="sc">+</span> p4  <span class="sc">+</span> p2<span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-7-1.png" width="3000" style="display: block; margin: auto;" /></p>
<p>With different methods, tumors with ecDNA consistently show significantly decreased immune scores.</p>
<p>We also calculated other infiltration scores including IPS Z-score, CYT and TIS:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>IPS <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/IPS.rds&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dt_IPS <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  IPS)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>dt_IPS <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>dt_IPS <span class="ot">&lt;-</span> dt_IPS <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_IPS,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>AZ))<span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;IPS Z-score&quot;</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>tis <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../data/tis_signature.txt&quot;</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>tis<span class="sc">$</span>sample <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tis)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>dt_tis <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  tis)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>dt_tis <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>dt_tis <span class="ot">&lt;-</span> dt_tis <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_tis,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>V1))<span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;TIS&quot;</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>cyts <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/cyts.rds&quot;</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>dt_cyts <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  cyts)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>dt_cyts <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)<span class="ot">-&gt;</span> summ</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>dt_cyts <span class="ot">&lt;-</span> dt_cyts <span class="sc">%&gt;%</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_cyts,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>cyts))<span class="sc">+</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">label.x=</span><span class="fl">1.2</span>,<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;CYT&quot;</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>p5 <span class="sc">+</span> p6 <span class="sc">+</span> p7</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-8-1.png" width="3900" style="display: block; margin: auto;" /></p>
<p>Then we look close into the difference of different immune cell types between samples with and without ecDNA using above methods:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;../data/ecDNA.Rdata&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>immune_data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../data/infiltration_estimation_for_tcga.csv&quot;</span>,<span class="at">header =</span> T,<span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ecDNA_tcga <span class="ot">&lt;-</span> ecData3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sample_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;TM&quot;</span>,<span class="st">&quot;TP&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;^TCGA.&quot;</span>,sample_barcode)) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ecDNA=</span><span class="fu">ifelse</span>(sample_classification<span class="sc">==</span><span class="st">&quot;Circular&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>,<span class="st">&quot;Non-ecDNA&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tcga_id=</span><span class="fu">get_cancer_type</span>(sample_barcode))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ecDNA_imm_info <span class="ot">&lt;-</span> ecDNA_tcga <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sample_barcode <span class="sc">%in%</span> immune_data<span class="sc">$</span>cell_type)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>ecDNA_imm_info <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(tcga_id) <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(.,<span class="at">ecDNA=</span><span class="fu">sum</span>(<span class="fu">ifelse</span>(ecDNA<span class="sc">==</span><span class="st">&quot;ecDNA&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ecDNA<span class="sc">&gt;</span><span class="dv">20</span>) <span class="ot">-&gt;</span> ecDNA_20_info</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>heat_data <span class="ot">&lt;-</span> ecDNA_tcga <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tcga_id <span class="sc">%in%</span> ecDNA_20_info<span class="sc">$</span>tcga_id)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="do">##Heatmap</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>tumor_type <span class="ot">&lt;-</span> ecDNA_20_info<span class="sc">$</span>tcga_id</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>heatmap_imm <span class="ot">&lt;-</span> <span class="cf">function</span>(heat_data2,cell_names){</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(cell_names<span class="sc">&gt;</span><span class="dv">0</span>)) {</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  heat_data2 <span class="ot">&lt;-</span> heat_data2[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(heat_data2) <span class="sc">%in%</span> cell_names)]</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  imm_ecDNA <span class="ot">&lt;-</span> heat_data2[<span class="fu">which</span>(heat_data2<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;ecDNA&quot;</span>),]</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  imm_NonecDNA <span class="ot">&lt;-</span> heat_data2[<span class="fu">which</span>(heat_data2<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;Non-ecDNA&quot;</span>),]</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  heat_fig <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol =</span> <span class="fu">length</span>(<span class="dv">9</span><span class="sc">:</span><span class="fu">length</span>(heat_data2)), <span class="at">nrow =</span> <span class="dv">8</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(heat_fig) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Pan-cancer&quot;</span>,tumor_type)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(heat_fig) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heat_data2)[<span class="dv">9</span><span class="sc">:</span><span class="fu">length</span>(heat_data2)]</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  cell_type <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heat_data2)[<span class="dv">9</span><span class="sc">:</span><span class="fu">length</span>(heat_data2)]</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> tumor_type) {</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ii <span class="cf">in</span> cell_type) {</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      data1 <span class="ot">&lt;-</span> <span class="fu">median</span>(imm_ecDNA[<span class="fu">which</span>(imm_ecDNA<span class="sc">$</span>tcga_id<span class="sc">==</span>i),][,ii])</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      data2 <span class="ot">&lt;-</span> <span class="fu">median</span>(imm_NonecDNA[<span class="fu">which</span>(imm_NonecDNA<span class="sc">$</span>tcga_id<span class="sc">==</span>i),][,ii])</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      heat_fig[i,ii] <span class="ot">&lt;-</span> <span class="fu">log</span>(data1<span class="fl">+1.001</span>) <span class="sc">/</span> <span class="fu">log</span>(data2<span class="fl">+1.001</span>)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ii <span class="cf">in</span> cell_type) {</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    data1 <span class="ot">&lt;-</span> <span class="fu">median</span>(imm_ecDNA[,ii])</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    data2 <span class="ot">&lt;-</span> <span class="fu">median</span>(imm_NonecDNA[,ii])</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    heat_fig[<span class="st">&quot;Pan-cancer&quot;</span>,ii] <span class="ot">&lt;-</span> <span class="fu">log</span>(data1<span class="fl">+1.001</span>) <span class="sc">/</span> <span class="fu">log</span>(data2<span class="fl">+1.001</span>)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  heat_fig2 <span class="ot">&lt;-</span> heat_fig</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  heat_fig2 <span class="ot">&lt;-</span> <span class="fu">t</span>(heat_fig2)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(heat_fig2)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(circlize)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>col_fun <span class="ot">=</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="fl">0.34</span>, <span class="dv">1</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="do">##CibersortABS</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*CIBERSORT.ABS$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CiberABS)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample_barcode&quot;</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>heat_data2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(heat_data,CiberABS)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>heat_data2<span class="sc">$</span>CD8_Treg._CIBERSORT.ABS <span class="ot">&lt;-</span> <span class="fu">log</span>(heat_data2[,<span class="st">&quot;T.cell.CD8._CIBERSORT.ABS&quot;</span>]<span class="sc">+</span><span class="fl">1.001</span>)<span class="sc">/</span><span class="fu">log</span>(heat_data2[,<span class="st">&quot;T.cell.regulatory..Tregs._CIBERSORT.ABS&quot;</span>]<span class="sc">+</span><span class="fl">1.001</span>)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>heat_data2<span class="sc">$</span>M1_M2._CIBERSORT.ABS <span class="ot">&lt;-</span> <span class="fu">log</span>(heat_data2[,<span class="st">&quot;Macrophage.M1_CIBERSORT.ABS&quot;</span>]<span class="sc">+</span><span class="fl">1.001</span>)<span class="sc">/</span><span class="fu">log</span>(heat_data2[,<span class="st">&quot;Macrophage.M2_CIBERSORT.ABS&quot;</span>]<span class="sc">+</span><span class="fl">1.001</span>)</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell.naive_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;T.cell.CD4..memory.resting_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;T.cell.follicular.helper_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;NK.cell.resting_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Macrophage.M0_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;Myeloid.dendritic.cell.resting_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Myeloid.dendritic.cell.activated_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;Mast.cell.resting_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Neutrophil_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;T.cell.CD4..naive_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Eosinophil_CIBERSORT.ABS&quot;</span>)</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>heat_fig2 <span class="ot">&lt;-</span> <span class="fu">heatmap_imm</span>(heat_data2,cell_names)</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(heat_fig2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B cell memory&quot;</span>,<span class="st">&quot;B cell plasma&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;T cell CD4 memory activated&quot;</span>,</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;T cell regulatory Tregs&quot;</span>,<span class="st">&quot;T cell gamma delta&quot;</span>,<span class="st">&quot;NK cell activated&quot;</span>,<span class="st">&quot;Monocyte&quot;</span>,</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Macrophage M1&quot;</span>,<span class="st">&quot;Macrophage M2&quot;</span>,<span class="st">&quot;Mast cell activated&quot;</span>,<span class="st">&quot;CD8/Tregs&quot;</span>,<span class="st">&quot;M1/M2&quot;</span>)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>heatmap_cibersortABS <span class="ot">&lt;-</span> ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(heat_fig2,<span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,<span class="at">name =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">row_title =</span> <span class="st">&quot;Cibersort&quot;</span>,<span class="at">col =</span> col_fun,</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">row_names_side =</span> <span class="st">&quot;right&quot;</span>,<span class="at">column_names_rot =</span> <span class="dv">45</span>,<span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">12</span>),</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">12</span>))</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="do">##Timer</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*_TIMER$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CiberABS)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample_barcode&quot;</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>heat_data2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(heat_data,CiberABS)</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>heat_fig2 <span class="ot">&lt;-</span> <span class="fu">heatmap_imm</span>(heat_data2,cell_names)</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(heat_fig2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B cell&quot;</span>,<span class="st">&quot;T cell CD4&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,<span class="st">&quot;Macrophage&quot;</span>,<span class="st">&quot;Myeloid dendritic cell&quot;</span>)</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>heatmap_timer <span class="ot">&lt;-</span> ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(heat_fig2,<span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,<span class="at">name =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">row_title =</span> <span class="st">&quot;Timer&quot;</span>,<span class="at">col =</span> col_fun,</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">row_names_side =</span> <span class="st">&quot;right&quot;</span>,<span class="at">column_names_rot =</span> <span class="dv">45</span>)</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="do">##Xcell</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*_XCELL$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CiberABS)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample_barcode&quot;</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>heat_data2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(heat_data,CiberABS)</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell_XCELL&quot;</span>, <span class="st">&quot;T.cell.CD4..memory_XCELL&quot;</span>,<span class="st">&quot;T.cell.CD4...non.regulatory._XCELL&quot;</span>,<span class="st">&quot;T.cell.CD8..naive_XCELL&quot;</span>,</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Common.lymphoid.progenitor_XCELL&quot;</span>,<span class="st">&quot;Myeloid.dendritic.cell_XCELL&quot;</span>,<span class="st">&quot;Macrophage_XCELL&quot;</span>,<span class="st">&quot;Monocyte_XCELL&quot;</span>,</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;T.cell.CD4..Th1_XCELL&quot;</span>,<span class="st">&quot;T.cell.CD4..Th2_XCELL&quot;</span>, <span class="st">&quot;B.cell.memory_XCELL&quot;</span>,<span class="st">&quot;B.cell.naive_XCELL&quot;</span>,<span class="st">&quot;T.cell.gamma.delta_XCELL&quot;</span>)</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>heat_fig2 <span class="ot">&lt;-</span> <span class="fu">heatmap_imm</span>(heat_data2,cell_names)</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(heat_fig2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Myeloid dendritic cell activated&quot;</span>,<span class="st">&quot;T cell CD4 naive&quot;</span>,<span class="st">&quot;T cell CD4 central memory&quot;</span>,</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;T cell CD4 effector memory&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;T cell CD8 central memory&quot;</span>,</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;T cell CD8 effector memory&quot;</span>,<span class="st">&quot;Class switched memory B cell&quot;</span>,<span class="st">&quot;Common myeloid progenitor&quot;</span>,</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Endothelial cell&quot;</span>,<span class="st">&quot;Eosinophil&quot;</span>,<span class="st">&quot;Cancer associated fibroblast&quot;</span>,<span class="st">&quot;Granulocyte monocyte progenitor&quot;</span>,</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Hematopoietic stem cell&quot;</span>,<span class="st">&quot;Macrophage M1&quot;</span>,<span class="st">&quot;Macrophage M2&quot;</span>,<span class="st">&quot;Mast cell&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;T cell NK&quot;</span>,<span class="st">&quot;Plasmacytoid dendritic cell&quot;</span>,<span class="st">&quot;B cell plasma&quot;</span>,<span class="st">&quot;T cell regulatory Tregs&quot;</span>,</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;immune score&quot;</span>,<span class="st">&quot;stroma score&quot;</span>,<span class="st">&quot;microenvironment score&quot;</span>)</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>heatmap_xcell <span class="ot">&lt;-</span> ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(heat_fig2,<span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">row_title =</span> <span class="st">&quot;Xcell&quot;</span>,<span class="at">col =</span> col_fun,</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">name =</span> <span class="st">&quot; &quot;</span>,<span class="at">row_names_side =</span><span class="st">&quot;right&quot;</span>,<span class="at">column_names_rot =</span> <span class="dv">45</span>)</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a><span class="do">##MCPCOUNTER</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*MCPCOUNTER$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CiberABS)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample_barcode&quot;</span></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>heat_data2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(heat_data,CiberABS)</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Cancer.associated.fibroblast_MCPCOUNTER&quot;</span>)</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>heat_fig2 <span class="ot">&lt;-</span> <span class="fu">heatmap_imm</span>(heat_data2,cell_names)</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(heat_fig2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;T cell&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;Cytotoxicity score&quot;</span>,<span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;B cell&quot;</span>,</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Monocyte&quot;</span>,<span class="st">&quot;Macrophage monocyte&quot;</span>,<span class="st">&quot;Myeloid dendritic cell&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,<span class="st">&quot;Endothelial cell&quot;</span>)</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>heatmap_MCPCOUNTER <span class="ot">&lt;-</span> ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(heat_fig2, <span class="at">cluster_rows =</span> F, <span class="at">cluster_columns =</span> F, <span class="at">row_title =</span> <span class="st">&quot;MCPcounter&quot;</span>,<span class="at">col =</span> col_fun,</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">name =</span> <span class="st">&quot; &quot;</span>,<span class="at">row_names_side =</span><span class="st">&quot;right&quot;</span>,<span class="at">column_names_rot =</span> <span class="dv">45</span>)</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="do">##QUANTISEQ</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*QUANTISEQ$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CiberABS)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample_barcode&quot;</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>heat_data2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(heat_data,CiberABS)</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;uncharacterized.cell_QUANTISEQ&quot;</span>,<span class="st">&quot;T.cell.CD4...non.regulatory._QUANTISEQ&quot;</span>,<span class="st">&quot;Monocyte_QUANTISEQ&quot;</span>)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>heat_fig2 <span class="ot">&lt;-</span> <span class="fu">heatmap_imm</span>(heat_data2,cell_names)</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(heat_fig2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B cell&quot;</span>,<span class="st">&quot;Macrophage M1&quot;</span>,<span class="st">&quot;Macrophage M2&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;T cell regulatory Tregs&quot;</span>,<span class="st">&quot;Myeloid dendritic cell&quot;</span>)</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>heatmap_QUANTISEQ<span class="ot">&lt;-</span> ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(heat_fig2,<span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">row_title =</span> <span class="st">&quot;Quantiseq&quot;</span>,<span class="at">col =</span> col_fun,</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">name =</span> <span class="st">&quot; &quot;</span>,<span class="at">row_names_side =</span><span class="st">&quot;right&quot;</span>,<span class="at">column_names_rot =</span> <span class="dv">45</span>)</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a><span class="do">##joint heatmap</span></span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>ht_list <span class="ot">=</span> heatmap_cibersortABS <span class="sc">%v%</span> heatmap_MCPCOUNTER <span class="sc">%v%</span> heatmap_timer <span class="sc">%v%</span> heatmap_QUANTISEQ <span class="sc">%v%</span> heatmap_xcell</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(ht_list)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-9-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Cibersort ABS</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*CIBERSORT.ABS$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>CiberABS_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell.memory_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;B.cell.plasma_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;NK.cell.activated_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;T.cell.CD8._CIBERSORT.ABS&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span>  CiberABS[,<span class="fu">c</span>(<span class="st">&quot;cell_type&quot;</span>,CiberABS_names)]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>Ciber_Data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>Ciber_Data  <span class="ot">&lt;-</span> <span class="fu">melt</span>(Ciber_Data)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Ciber_Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>Ciber_Data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(Ciber_Data<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">12</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="do">##Xcell</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>Xcell <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*_XCELL$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] <span class="do">##ƥ??_XCELL????</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>Xcell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell.plasma_XCELL&quot;</span>,<span class="st">&quot;NK.cell_XCELL&quot;</span>,<span class="st">&quot;T.cell.CD4..central.memory_XCELL&quot;</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;T.cell.CD4..effector.memory_XCELL&quot;</span>,<span class="st">&quot;T.cell.CD8._XCELL&quot;</span>,<span class="st">&quot;T.cell.CD8..central.memory_XCELL&quot;</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;T.cell.CD8..effector.memory_XCELL&quot;</span>,<span class="st">&quot;T.cell.NK_XCELL&quot;</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>Xcell <span class="ot">&lt;-</span>  Xcell[,<span class="fu">c</span>(<span class="st">&quot;cell_type&quot;</span>,Xcell_names)]</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> Xcell[<span class="fu">which</span>(Xcell<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> Xcell[<span class="fu">which</span>(Xcell<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>Xcell_Data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>Xcell_Data  <span class="ot">&lt;-</span> <span class="fu">melt</span>(Xcell_Data)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Xcell_Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>Xcell_Data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(Xcell_Data<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">4</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="do">##Timer</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>Timer <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*_TIMER$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] <span class="do">##ƥ??_XCELL????</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>Timer_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell_TIMER&quot;</span>,<span class="st">&quot;T.cell.CD4._TIMER&quot;</span>,<span class="st">&quot;T.cell.CD8._TIMER&quot;</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>Timer <span class="ot">&lt;-</span> Timer[,<span class="fu">c</span>(<span class="st">&quot;cell_type&quot;</span>,Timer_names)]</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> Timer[<span class="fu">which</span>(Timer<span class="sc">$</span>cell_type <span class="sc">%in%</span> ecDNA_tcga[<span class="fu">which</span>(ecDNA_tcga<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> Timer[<span class="fu">which</span>(Timer<span class="sc">$</span>cell_type <span class="sc">%in%</span> ecDNA_tcga[<span class="fu">which</span>(ecDNA_tcga<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>Timer_Data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>Timer_Data  <span class="ot">&lt;-</span> <span class="fu">melt</span>(Timer_Data)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Timer_Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>Timer_Data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(Timer_Data<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">4</span>)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="do">##MCPCOUNTER</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>MCPcounter <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*MCPCOUNTER$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>MCP_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell_MCPCOUNTER&quot;</span>,<span class="st">&quot;NK.cell_MCPCOUNTER&quot;</span>,<span class="st">&quot;T.cell_MCPCOUNTER&quot;</span>,<span class="st">&quot;T.cell.CD8._MCPCOUNTER&quot;</span>)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>MCPcounter <span class="ot">&lt;-</span> MCPcounter[,<span class="fu">c</span>(<span class="st">&quot;cell_type&quot;</span>,MCP_names)]</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> MCPcounter[<span class="fu">which</span>(MCPcounter<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> MCPcounter[<span class="fu">which</span>(MCPcounter<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>MCPcounter_Data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>MCPcounter_Data  <span class="ot">&lt;-</span> <span class="fu">melt</span>(MCPcounter_Data)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(MCPcounter_Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>MCPcounter_Data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(MCPcounter_Data<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">9</span>)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>MCPcounter_Data<span class="sc">$</span>Composition <span class="ot">&lt;-</span> <span class="fu">log</span>(MCPcounter_Data<span class="sc">$</span>Composition<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="do">##QUANTISEQ</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>Quantiseq <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*QUANTISEQ$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>QUAN_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell_QUANTISEQ&quot;</span>,<span class="st">&quot;NK.cell_QUANTISEQ&quot;</span>,<span class="st">&quot;T.cell.CD8._QUANTISEQ&quot;</span>)</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>Quantiseq <span class="ot">&lt;-</span> Quantiseq[,<span class="fu">c</span>(<span class="st">&quot;cell_type&quot;</span>,QUAN_names)]</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> Quantiseq[<span class="fu">which</span>(Quantiseq<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> Quantiseq[<span class="fu">which</span>(Quantiseq<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>Quantiseq_Data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>Quantiseq_Data  <span class="ot">&lt;-</span> <span class="fu">melt</span>(Quantiseq_Data)</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Quantiseq_Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>Quantiseq_Data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(Quantiseq_Data<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">9</span>)</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>draw_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Ciber_Data,Xcell_Data,Timer_Data,MCPcounter_Data,Quantiseq_Data)</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Celltype,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;B.cell.memory_CI&quot;</span>,<span class="st">&quot;B.cell.plasma_CI&quot;</span>,<span class="st">&quot;NK.cell.activated_CI&quot;</span>,<span class="st">&quot;T.cell.CD8._CI&quot;</span>,</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;B.cell.plasma_XC&quot;</span>,<span class="st">&quot;NK.cell_XC&quot;</span>,<span class="st">&quot;T.cell.CD4..central.memory_XC&quot;</span>,<span class="st">&quot;T.cell.CD4..effector.memory_XC&quot;</span>,</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;T.cell.CD8..central.memory_XC&quot;</span>,<span class="st">&quot;T.cell.CD8..effector.memory_XC&quot;</span>,<span class="st">&quot;T.cell.CD8._XC&quot;</span>,<span class="st">&quot;T.cell.NK_XC&quot;</span>,</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;B.cell_TI&quot;</span>,<span class="st">&quot;T.cell.CD4._TI&quot;</span>,<span class="st">&quot;T.cell.CD8._TI&quot;</span>,</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;B.cell_MC&quot;</span>,<span class="st">&quot;NK.cell_MC&quot;</span>,<span class="st">&quot;T.cell.CD8._MC&quot;</span>,<span class="st">&quot;T.cell_MC&quot;</span>,</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;B.cell_Q&quot;</span>,<span class="st">&quot;NK.cell_Q&quot;</span>,<span class="st">&quot;T.cell.CD8._Q&quot;</span>))</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Group,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggprism)</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>draw_data,<span class="fu">aes</span>(<span class="at">x=</span>Celltype,<span class="at">y=</span>Composition,<span class="at">fill=</span>Group))<span class="sc">+</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Composition&quot;</span>,<span class="at">x=</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="st">&quot;B.cell.memory_CI&quot;</span>,<span class="st">&quot;B.cell.plasma_CI&quot;</span>,<span class="st">&quot;NK.cell.activated_CI&quot;</span>,<span class="st">&quot;T.cell.CD8._CI&quot;</span>,</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;B.cell.plasma_XC&quot;</span>,<span class="st">&quot;NK.cell_XC&quot;</span>,<span class="st">&quot;T.cell.CD4..central.memory_XC&quot;</span>,<span class="st">&quot;T.cell.CD4..effector.memory_XC&quot;</span>,</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;T.cell.CD8..central.memory_XC&quot;</span>,<span class="st">&quot;T.cell.CD8..effector.memory_XC&quot;</span>,<span class="st">&quot;T.cell.CD8._XC&quot;</span>,<span class="st">&quot;T.cell.NK_XC&quot;</span>,</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;B.cell_TI&quot;</span>,<span class="st">&quot;T.cell.CD4._TI&quot;</span>,<span class="st">&quot;T.cell.CD8._TI&quot;</span>,</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;B.cell_MC&quot;</span>,<span class="st">&quot;NK.cell_MC&quot;</span>,<span class="st">&quot;T.cell.CD8._MC&quot;</span>,<span class="st">&quot;T.cell_MC&quot;</span>,</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;B.cell_Q&quot;</span>,<span class="st">&quot;NK.cell_Q&quot;</span>,<span class="st">&quot;T.cell.CD8._Q&quot;</span>),<span class="co">#???ú?????????</span></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;B cell memory&quot;</span>,<span class="st">&quot;B cell plasma&quot;</span>,<span class="st">&quot;NK cell activated&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;B cell plasma&quot;</span>,<span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;T cell CD4 central memory&quot;</span>,<span class="st">&quot;T cell CD4 effector memory&quot;</span>,</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;T cell CD8 central memory&quot;</span>,<span class="st">&quot;T cell CD8 effector memory&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;T cell NK&quot;</span>,</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;B cell&quot;</span>,<span class="st">&quot;T cell CD4&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,</span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;B cell&quot;</span>,<span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;T cell&quot;</span>,</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;B cell&quot;</span>,<span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>))</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-10-1.png" width="2400" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Boxplot</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggprism)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">##XCELL</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*_XCELL$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ScoreDraw <span class="ot">&lt;-</span> CiberDraw[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">37</span>,<span class="dv">41</span>)]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell_XCELL&quot;</span>,<span class="st">&quot;T.cell.CD4..memory_XCELL&quot;</span>,<span class="st">&quot;T.cell.CD4...non.regulatory._XCELL&quot;</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;T.cell.CD8..naive_XCELL&quot;</span>,<span class="st">&quot;Common.lymphoid.progenitor_XCELL&quot;</span>,<span class="st">&quot;Myeloid.dendritic.cell_XCELL&quot;</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Macrophage_XCELL&quot;</span>,<span class="st">&quot;Monocyte_XCELL&quot;</span>,<span class="st">&quot;T.cell.CD4..Th1_XCELL&quot;</span>,<span class="st">&quot;T.cell.CD4..Th2_XCELL&quot;</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;B.cell.memory_XCELL&quot;</span>,<span class="st">&quot;B.cell.naive_XCELL&quot;</span>,<span class="st">&quot;T.cell.gamma.delta_XCELL&quot;</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>ScoreDraw <span class="ot">&lt;-</span>  ScoreDraw[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(ScoreDraw) <span class="sc">%in%</span> cell_names)]</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>ScoreDraw <span class="ot">&lt;-</span> <span class="fu">melt</span>(ScoreDraw)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ScoreDraw) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>ScoreDraw<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(ScoreDraw<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">7</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>draw_data <span class="ot">&lt;-</span> ScoreDraw</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>nams_id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell.plasma&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,<span class="st">&quot;NK.cell&quot;</span>,<span class="st">&quot;Mast.cell&quot;</span>,<span class="st">&quot;Eosinophil&quot;</span>,<span class="st">&quot;Cancer.associated.fibroblast&quot;</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Class.switched.memory.B.cell&quot;</span>,<span class="st">&quot;Common.myeloid.progenitor&quot;</span>,<span class="st">&quot;Endothelial.cell&quot;</span>,<span class="st">&quot;Granulocyte.monocyte.progenitor&quot;</span>,</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Hematopoietic.stem.cell&quot;</span>,<span class="st">&quot;Macrophage.M1&quot;</span>,<span class="st">&quot;Macrophage.M2&quot;</span>,<span class="st">&quot;Myeloid.dendritic.cell.activated&quot;</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Plasmacytoid.dendritic.cell&quot;</span>,<span class="st">&quot;T.cell.CD4..central.memory&quot;</span>,<span class="st">&quot;T.cell.CD4..effector.memory&quot;</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;T.cell.CD4..naive&quot;</span>,<span class="st">&quot;T.cell.CD8.&quot;</span>,<span class="st">&quot;T.cell.CD8..central.memory&quot;</span>,<span class="st">&quot;T.cell.CD8..effector.memory&quot;</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;T.cell.NK&quot;</span>,<span class="st">&quot;T.cell.regulatory..Tregs.&quot;</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Celltype,<span class="at">levels =</span> nams_id)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Group,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>boxplot_xcell <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>draw_data,<span class="fu">aes</span>(<span class="at">x=</span>Celltype,<span class="at">y=</span>Composition,<span class="at">fill=</span>Group))<span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) )<span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Composition&quot;</span>,<span class="at">x=</span> <span class="cn">NULL</span>,<span class="at">title =</span> <span class="st">&quot;XCell&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks=</span>nams_id,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;B cell plasma&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,<span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;Mast cell&quot;</span>,<span class="st">&quot;Eosinophil&quot;</span>,<span class="st">&quot;Cancer associated fibroblast&quot;</span>,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Class switched memory B cell&quot;</span>,<span class="st">&quot;Common myeloid progenitor&quot;</span>,<span class="st">&quot;Endothelial cell&quot;</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Granulocyte monocyte progenitor&quot;</span>,</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Hematopoietic stem cell&quot;</span>,<span class="st">&quot;Macrophage M1&quot;</span>,<span class="st">&quot;Macrophage M2&quot;</span>,<span class="st">&quot;Myeloid dendritic cell activated&quot;</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Plasmacytoid dendritic cell&quot;</span>,<span class="st">&quot;T cell CD4 central memory&quot;</span>,<span class="st">&quot;T cell CD4 effector memory&quot;</span>,</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;T cell CD4 naive&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;T cell CD8 central memory&quot;</span>,<span class="st">&quot;T cell CD8 effector memory&quot;</span>,</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;T cell NK&quot;</span>,<span class="st">&quot;T cell regulatory Tregs&quot;</span>))</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="do">##CIBERSORT.ABS</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*CIBERSORT.ABS$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell.naive_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;T.cell.CD4..memory.resting_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;T.cell.follicular.helper_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;NK.cell.resting_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Macrophage.M0_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;Myeloid.dendritic.cell.resting_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Myeloid.dendritic.cell.activated_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;Mast.cell.resting_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Neutrophil_CIBERSORT.ABS&quot;</span>,<span class="st">&quot;T.cell.CD4..naive_CIBERSORT.ABS&quot;</span>,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Eosinophil_CIBERSORT.ABS&quot;</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span>  CiberABS[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(CiberABS) <span class="sc">%in%</span> cell_names)]</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span> <span class="fu">melt</span>(CiberDraw)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CiberDraw) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>CiberDraw<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(CiberDraw<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">15</span>)</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>draw_data <span class="ot">&lt;-</span> CiberDraw</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>nams_id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell.memory&quot;</span>,<span class="st">&quot;B.cell.plasma&quot;</span>,<span class="st">&quot;Macrophage.M1&quot;</span>,<span class="st">&quot;Macrophage.M2&quot;</span>,<span class="st">&quot;Mast.cell.activated&quot;</span>,</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Monocyte&quot;</span>,<span class="st">&quot;NK.cell.activated&quot;</span>,<span class="st">&quot;T.cell.CD4..memory.activated&quot;</span>,<span class="st">&quot;T.cell.CD8.&quot;</span>,</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;T.cell.gamma.delta&quot;</span>,<span class="st">&quot;T.cell.regulatory..Tregs.&quot;</span> )</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Celltype,<span class="at">levels =</span> nams_id)</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Group,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>boxplot_cibersortABS <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>draw_data,<span class="fu">aes</span>(<span class="at">x=</span>Celltype,<span class="at">y=</span>Composition,<span class="at">fill=</span>Group))<span class="sc">+</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) )<span class="sc">+</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Composition&quot;</span>,<span class="at">x=</span> <span class="cn">NULL</span>,<span class="at">title =</span> <span class="st">&quot;CibersortABS&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks=</span>nams_id,</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;B cell memory&quot;</span>,<span class="st">&quot;B cell plasma&quot;</span>,<span class="st">&quot;Macrophage M1&quot;</span>,<span class="st">&quot;Macrophage M2&quot;</span>,<span class="st">&quot;Mast cell activated&quot;</span>,</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Monocyte&quot;</span>,<span class="st">&quot;NK cell activated&quot;</span>,<span class="st">&quot;T cell CD4 memory activated&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;T cell gamma delta&quot;</span>,<span class="st">&quot;T cell regulatory Tregs&quot;</span> ))</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a><span class="do">##Timer</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*_TIMER$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> ecDNA_tcga[<span class="fu">which</span>(ecDNA_tcga<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> ecDNA_tcga[<span class="fu">which</span>(ecDNA_tcga<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) {</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>  CiberDraw[,i] <span class="ot">&lt;-</span> (CiberDraw[,i] <span class="sc">-</span> <span class="fu">min</span>(CiberDraw[,i]))<span class="sc">/</span> (<span class="fu">max</span>(CiberDraw[,i]) <span class="sc">-</span> <span class="fu">min</span>(CiberDraw[,i]))</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>ScoreDraw <span class="ot">&lt;-</span> <span class="fu">melt</span>(CiberDraw)</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ScoreDraw) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>ScoreDraw<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(ScoreDraw<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">7</span>)</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>ScoreDraw <span class="ot">&lt;-</span> ScoreDraw[<span class="sc">-</span><span class="fu">which</span>(ScoreDraw<span class="sc">$</span>Composition<span class="sc">==</span><span class="dv">1</span>),]</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>draw_data <span class="ot">&lt;-</span> ScoreDraw</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>nams_id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell&quot;</span>,<span class="st">&quot;Macrophage&quot;</span>,<span class="st">&quot;Myeloid.dendritic.cell&quot;</span>,</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Neutrophil&quot;</span>,<span class="st">&quot;T.cell.CD4.&quot;</span>,<span class="st">&quot;T.cell.CD8.&quot;</span>)</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Celltype,<span class="at">levels =</span> nams_id)</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Group,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>boxplot_timer <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>draw_data,<span class="fu">aes</span>(<span class="at">x=</span>Celltype,<span class="at">y=</span>Composition,<span class="at">fill=</span>Group))<span class="sc">+</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) )<span class="sc">+</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Composition&quot;</span>,<span class="at">x=</span> <span class="cn">NULL</span>,<span class="at">title =</span> <span class="st">&quot;Timer&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks=</span>nams_id,</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;B cell&quot;</span>,<span class="st">&quot;Macrophage&quot;</span>,<span class="st">&quot;Myeloid dendritic cell&quot;</span>,</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Neutrophil&quot;</span>,<span class="st">&quot;T cell CD4&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>))</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a><span class="do">##MCPCOUNTER</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*MCPCOUNTER$&quot;</span>,<span class="fu">colnames</span>(immune_data)))]</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Cancer.associated.fibroblast_MCPCOUNTER&quot;</span>)</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span>  CiberDraw[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(CiberDraw) <span class="sc">%in%</span> cell_names)]</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span> <span class="fu">melt</span>(CiberDraw)</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CiberDraw) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>CiberDraw<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(CiberDraw<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">12</span>)</span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>CiberDraw<span class="sc">$</span>Composition <span class="ot">&lt;-</span> <span class="fu">log</span>(CiberDraw<span class="sc">$</span>Composition<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>draw_data <span class="ot">&lt;-</span> CiberDraw</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>nams_id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell&quot;</span>,<span class="st">&quot;cytotoxicity.score&quot;</span>,<span class="st">&quot;Endothelial.cell&quot;</span>,<span class="st">&quot;Macrophage.Monocyte&quot;</span>,</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Monocyte&quot;</span>,<span class="st">&quot;Myeloid.dendritic.cell&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,<span class="st">&quot;NK.cell&quot;</span>,<span class="st">&quot;T.cell&quot;</span>,<span class="st">&quot;T.cell.CD8.&quot;</span>)</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Celltype,<span class="at">levels =</span> nams_id)</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Group,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>boxplot_MCPCOUNTER <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>draw_data,<span class="fu">aes</span>(<span class="at">x=</span>Celltype,<span class="at">y=</span>Composition,<span class="at">fill=</span>Group))<span class="sc">+</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) )<span class="sc">+</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Composition&quot;</span>,<span class="at">x=</span> <span class="cn">NULL</span>,<span class="at">title =</span> <span class="st">&quot;MCPCOUNTER&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks=</span>nams_id,</span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span> <span class="fu">c</span>(<span class="st">&quot;B cell&quot;</span>,<span class="st">&quot;Cytotoxicity score&quot;</span>,<span class="st">&quot;Endothelial cell&quot;</span>,<span class="st">&quot;Macrophage monocyte&quot;</span>,</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Monocyte&quot;</span>,<span class="st">&quot;Myeloid dendritic cell&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,<span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;T cell&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>))</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a><span class="do">##QUANTISEQ</span></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>CiberABS <span class="ot">&lt;-</span> immune_data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">grep</span>(<span class="st">&quot;*QUANTISEQ$&quot;</span>,<span class="fu">colnames</span>(immune_data)))] </span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>imm_ecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA <span class="ot">&lt;-</span> CiberABS[<span class="fu">which</span>(CiberABS<span class="sc">$</span>cell_type <span class="sc">%in%</span> heat_data[<span class="fu">which</span>(heat_data<span class="sc">$</span>ecDNA <span class="sc">==</span> <span class="st">&quot;Non-ecDNA&quot;</span>),]<span class="sc">$</span>sample_barcode),]</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>imm_ecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;ecDNA&quot;</span></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>imm_NonecDNA<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;Non-ecDNA&quot;</span></span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span> <span class="fu">rbind</span>(imm_ecDNA,imm_NonecDNA)</span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>cell_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;uncharacterized.cell_QUANTISEQ&quot;</span>,<span class="st">&quot;T.cell.CD4...non.regulatory._QUANTISEQ&quot;</span>,<span class="st">&quot;Monocyte_QUANTISEQ&quot;</span>)</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span>  CiberDraw[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(CiberDraw) <span class="sc">%in%</span> cell_names)]</span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>CiberDraw <span class="ot">&lt;-</span> <span class="fu">melt</span>(CiberDraw)</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CiberDraw) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sample&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;Celltype&quot;</span>,<span class="st">&quot;Composition&quot;</span>)</span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>CiberDraw<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(CiberDraw<span class="sc">$</span>Celltype,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">11</span>)</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>draw_data <span class="ot">&lt;-</span> CiberDraw</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>nams_id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B.cell&quot;</span>,<span class="st">&quot;Macrophage.M1&quot;</span>,<span class="st">&quot;Macrophage.M2&quot;</span>,<span class="st">&quot;Myeloid.dendritic.cell&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;NK.cell&quot;</span>,<span class="st">&quot;T.cell.CD8.&quot;</span>,<span class="st">&quot;T.cell.regulatory..Tregs.&quot;</span>)</span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Celltype <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Celltype,<span class="at">levels =</span> nams_id)</span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>draw_data<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(draw_data<span class="sc">$</span>Group,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>boxplot_QUANTISEQ <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>draw_data,<span class="fu">aes</span>(<span class="at">x=</span>Celltype,<span class="at">y=</span>Composition,<span class="at">fill=</span>Group))<span class="sc">+</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) )<span class="sc">+</span></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Composition&quot;</span>,<span class="at">x=</span> <span class="cn">NULL</span>,<span class="at">title =</span> <span class="st">&quot;QUANTISEQ&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks=</span>nams_id,</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span> <span class="fu">c</span>(<span class="st">&quot;B cell&quot;</span>,<span class="st">&quot;Macrophage M1&quot;</span>,<span class="st">&quot;Macrophage M2&quot;</span>,<span class="st">&quot;Myeloid dendritic cell&quot;</span>,<span class="st">&quot;Neutrophil&quot;</span>,</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;NK cell&quot;</span>,<span class="st">&quot;T cell CD8&quot;</span>,<span class="st">&quot;T cell regulatory Tregs&quot;</span>))</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a><span class="do">##joint figure</span></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(customLayout)</span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>lay1 <span class="ot">&lt;-</span> <span class="fu">lay_new</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">nc =</span> <span class="dv">2</span>),<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>lay2 <span class="ot">&lt;-</span> <span class="fu">lay_new</span>(<span class="fu">matrix</span>(<span class="dv">1</span>, <span class="at">nc =</span> <span class="dv">1</span>))</span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">lay_bind_row</span>(lay1, lay2, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>plots2 <span class="ot">&lt;-</span> <span class="fu">list</span>(boxplot_cibersortABS,boxplot_MCPCOUNTER,boxplot_timer,boxplot_QUANTISEQ,boxplot_xcell)</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a><span class="fu">lay_grid</span>(plots2, cl)</span></code></pre></div>
<pre><code>#&gt; Warning: Removed 15 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>#&gt; Warning: Removed 15 rows containing non-finite values (stat_compare_means).</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-11-1.png" width="4200" style="display: block; margin: auto;" /></p>
</div>
<div id="ecdna-and-tumor-immune-typing" class="section level2">
<h2>EcDNA and tumor immune typing</h2>
<p>Recently, several studies have classified cancers into different immune subtypes and found each subtype related to specific microenvironment. Here we used Chisq-square test to check the association between ecDNA status and immune subtypes. We used two classification methods: 1) Pan-cancer immunogenomic analysis has classified cancer into six immune subtypes—wound healing, IFN-γ dominant, inflammatory, lymphocyte depleted, immunologically quiet, and TGF-β dominant (Thorsson et al., 2018), 2) The TME has been classified into 4 types according to the expression of immune and stromal related genes (Bagaev et al., 2021).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>summ <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>dt_filter <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../data/annotation-tcga.tsv&quot;</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">header =</span> T)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>dt_anno <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  dt_filter <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">substr</span>(sample,<span class="dv">1</span>,<span class="dv">12</span>)),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  anno <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(X,MFP) <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">sample=</span>X)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="fu">table</span>(dt_anno<span class="sc">$</span>ecDNA,dt_anno<span class="sc">$</span>MFP))</span></code></pre></div>
<pre><code>#&gt; 
#&gt;  Pearson&#39;s Chi-squared test
#&gt; 
#&gt; data:  table(dt_anno$ecDNA, dt_anno$MFP)
#&gt; X-squared = 14.142, df = 3, p-value = 0.002718</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dt_anno <span class="ot">&lt;-</span> dt_anno <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ecDNA,MFP) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">counts=</span><span class="fu">n</span>())</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_anno,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>counts,<span class="at">fill=</span>MFP))<span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,<span class="at">position=</span><span class="st">&quot;fill&quot;</span>)<span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Percent of cases (%)&quot;</span>,<span class="at">title =</span> <span class="st">&quot;Chi-squared test, P = 0.002718&quot;</span>)<span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>immune_landscape <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/immune_landscape.rds&quot;</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>dt_immune <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  dt_filter <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">substr</span>(sample,<span class="dv">1</span>,<span class="dv">12</span>)),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  immune_landscape <span class="sc">%&gt;%</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">TCGA Participant Barcode</span><span class="st">`</span>,<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>,<span class="st">`</span><span class="at">Leukocyte Fraction</span><span class="st">`</span>,<span class="st">`</span><span class="at">Intratumor Heterogeneity</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">sample=</span><span class="st">`</span><span class="at">TCGA Participant Barcode</span><span class="st">`</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>dt_subtype <span class="ot">&lt;-</span> dt_immune <span class="sc">%&gt;%</span> <span class="fu">select</span>(sample,ecDNA,<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>,cancer) <span class="sc">%&gt;%</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>))</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>dt_subtype<span class="sc">$</span><span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">as.character</span>(dt_subtype<span class="sc">$</span><span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="fu">table</span>(dt_subtype<span class="sc">$</span>ecDNA,dt_subtype<span class="sc">$</span><span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>))</span></code></pre></div>
<pre><code>#&gt; 
#&gt;  Pearson&#39;s Chi-squared test
#&gt; 
#&gt; data:  table(dt_subtype$ecDNA, dt_subtype$`Immune Subtype`)
#&gt; X-squared = 25.383, df = 4, p-value = 4.212e-05</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dt_subtype <span class="ot">&lt;-</span> dt_subtype <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ecDNA,<span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">counts=</span><span class="fu">n</span>())</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>p9 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>dt_subtype,<span class="fu">aes</span>(<span class="at">x=</span>ecDNA,<span class="at">y=</span>counts,<span class="at">fill=</span><span class="st">`</span><span class="at">Immune Subtype</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,<span class="at">position=</span><span class="st">&quot;fill&quot;</span>)<span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Percent of cases (%)&quot;</span>,<span class="at">title =</span> <span class="st">&quot;Chi-squared test, P = 4.212e-05&quot;</span>)<span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;#FE0000&quot;</span>,<span class="st">&quot;#FEFB04&quot;</span>,<span class="st">&quot;#13FC00&quot;</span>,<span class="st">&quot;#00FDFE&quot;</span>,<span class="st">&quot;#FC2AFD&quot;</span>))<span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))<span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>p8 <span class="sc">+</span> p9</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-12-1.png" width="2400" /></p>
<p>In tumors with ecDNA, C4 (lymphocyte depleted) type TME is up-regulated, while C3 (inflammatory) and C6 (TGF-β dominant) types are down-regulated and immune-enriched, fibrotic (IE/F) type of TME is dramatically decreased, while immune desert type TME is significantly up-regulated.</p>
</div>
<div id="ecdna-and-tumor-immune-escape" class="section level2">
<h2>EcDNA and tumor immune escape</h2>
<p>We next checked the expression difference of immune inhibitory immune checkpoint genes, such as PD-L1, CTLA4 between samples with and without ecDNA:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>checkpoint <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ADORA2A&quot;</span>, <span class="st">&quot;CD276&quot;</span>, <span class="st">&quot;VTCN1&quot;</span>, <span class="st">&quot;BTLA&quot;</span>, <span class="st">&quot;CTLA4&quot;</span>, <span class="st">&quot;IDO1&quot;</span>,<span class="st">&quot;LAG3&quot;</span>,<span class="st">&quot;CYBB&quot;</span>,<span class="st">&quot;PDCD1&quot;</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;HAVCR2&quot;</span>,<span class="st">&quot;C10orf54&quot;</span>,<span class="st">&quot;SIGLEC7&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>tpm_gene_log2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../../tmp/tpm_gene_log2.rds&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>tpm_gene_log2 <span class="ot">&lt;-</span> tpm_gene_log2[<span class="sc">!</span><span class="fu">duplicated</span>(tpm_gene_log2<span class="sc">$</span>gene),]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene_log2 <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gene <span class="sc">%in%</span> checkpoint) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gene,<span class="fu">any_of</span>(dt<span class="sc">$</span>sample_barcode))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tpm_gene) <span class="ot">&lt;-</span> tpm_gene<span class="sc">$</span>gene</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>gene)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> <span class="fu">t</span>(tpm_gene) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>sample <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tpm_gene)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">get_cancer_type</span>(tpm_gene<span class="sc">$</span>sample)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(tpm_gene,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                       dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ecdna_c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="ot">-&gt;</span> tpm_summ</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>tpm_summ <span class="ot">&lt;-</span> tpm_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ecdna_c<span class="sc">&gt;</span><span class="dv">20</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> tpm_summ<span class="sc">$</span>cancer)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>   tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">&quot;LAG3&quot;</span><span class="sc">:</span><span class="st">&quot;PDCD1&quot;</span>,<span class="at">names_to =</span> <span class="st">&quot;gene&quot;</span>,<span class="at">values_to =</span> <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>exp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(tpm_dt<span class="sc">$</span>exp)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_dt <span class="sc">%&gt;%</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ecDNA =</span> <span class="fu">ifelse</span>(ecDNA <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>,<span class="st">&quot;Non-ecDNA&quot;</span>))</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">factor</span>(tpm_dt<span class="sc">$</span>ecDNA,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>tpm_dt,<span class="fu">aes</span>(<span class="at">x=</span>gene,<span class="at">y=</span>exp,<span class="at">fill=</span>ecDNA))<span class="sc">+</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;log2(TPM + 0.001)&quot;</span>)<span class="sc">+</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-13-1.png" width="3000" style="display: block; margin: auto;" /></p>
<p>Then we checked the cancer type specific checkpoint expression difference, heatmap color indicates median difference of expression for specific gene in specific cancer type between ecDNA and non-ecDNA samples:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">12</span><span class="sc">*</span><span class="dv">7</span>),<span class="at">nrow =</span> <span class="dv">12</span>,<span class="at">ncol =</span> <span class="dv">7</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">unique</span>(tpm_gene<span class="sc">$</span>cancer)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mat)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>mat<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">unique</span>(tpm_dt<span class="sc">$</span>gene)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(mat)[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(mat)<span class="sc">-</span><span class="dv">1</span>)]){</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> mat<span class="sc">$</span>gene){</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(j,cancer,ecDNA) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(cancer <span class="sc">==</span> i)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;tt&quot;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>tt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>tt)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    mat[mat<span class="sc">$</span>gene <span class="sc">==</span> j,i] <span class="ot">&lt;-</span> <span class="fu">median</span>(df[df<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>,<span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">median</span>(df[df<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;no&quot;</span>,<span class="dv">1</span>])</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> mat<span class="sc">$</span>gene</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> mat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>gene)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(circlize)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>col_fun <span class="ot">=</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(mat,<span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,<span class="at">name =</span> <span class="st">&quot; &quot;</span>,<span class="at">col =</span> col_fun)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-14-1.png" width="2400" /></p>
<p>These checkpoints are generally down-regulated, and this could also implicates that immune checkpoint inhibitor therapy alone may not work in tumors with ecDNA.</p>
</div>
<div id="potential-mechanistic-study" class="section level2">
<h2>Potential mechanistic study</h2>
<p>The immunogenicity of tumor cells determine the tumor associated immune response, and the antigenicity encoded by neoantigenic mutations is an important determinant of tumor immunogenicity. Therefore we checked the tumor mutation burden (TMB) and neo-antigens burden between samples with and without ecDNA.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">###TMB</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mut &lt;- read.table(&quot;~/useful_data/GDC-PANCAN.mutect2_snv.tsv&quot;,sep = &quot;\t&quot;,header = T)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mut &lt;- mut %&gt;% filter(effect == &quot;missense_variant&quot;)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mut_summ &lt;- mut %&gt;% group_by(Sample_ID) %&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(tmb=n()/38) %&gt;% rename(sample=Sample_ID)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(mut_summ,file = &quot;data/mut_summ.rds&quot;)</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>mut_summ <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/mut_summ.rds&quot;</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>dt_mut <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  mut_summ <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample=</span><span class="fu">substr</span>(sample,<span class="dv">1</span>,<span class="dv">15</span>))</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>dt_mut <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>) <span class="ot">-&gt;</span> summ</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>dt_mut <span class="ot">&lt;-</span> dt_mut <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>dt_mut<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dt_mut<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>,<span class="st">&quot;Non-ecDNA&quot;</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>dt_mut<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">factor</span>(dt_mut<span class="sc">$</span>ecDNA,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dt_mut,<span class="fu">aes</span>(<span class="at">x=</span>cancer,<span class="at">y=</span><span class="fu">log</span>(tmb<span class="sc">+</span><span class="dv">1</span>),<span class="at">fill=</span>ecDNA))<span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;log(TMB + 1)&quot;</span>)<span class="sc">+</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) )<span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-15-1.png" width="2400" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">##neoantigen</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all_mut &lt;- readRDS(&quot;~/test/data/2021_04_01/all_mut.rds&quot;)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># all_mut &lt;- all_mut %&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(neo=ifelse(neo==&quot;neo&quot;,&quot;yes&quot;,&quot;no&quot;))</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># all_mut %&gt;% group_by(sample) %&gt;% summarise(neo_c=sum(neo==&quot;yes&quot;),all_c=n()) -&gt; neo_summ</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(neo_summ,file = &quot;data/neo_summ.rds&quot;)</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>neo_summ <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/neo_summ.rds&quot;</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>dt_neo <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  neo_summ <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">substr</span>(sample,<span class="dv">1</span>,<span class="dv">15</span>))</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">neo_burden=</span>neo_c<span class="sc">/</span><span class="dv">38</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>dt_neo <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>) <span class="ot">-&gt;</span> summ</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>dt_neo <span class="ot">&lt;-</span> dt_neo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>dt_neo<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dt_neo<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>,<span class="st">&quot;Non-ecDNA&quot;</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>dt_neo<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">factor</span>(dt_neo<span class="sc">$</span>ecDNA,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dt_neo,<span class="fu">aes</span>(<span class="at">x=</span>cancer,<span class="at">y=</span><span class="fu">log</span>(neo_burden<span class="sc">+</span><span class="dv">1</span>),<span class="at">fill=</span>ecDNA))<span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;log(Neoantigen burden + 1)&quot;</span>)<span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) )<span class="sc">+</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-15-2.png" width="2400" /></p>
<p>Tumors with ecDNA show comparable TMB and neoantigen counts, suggesting a comparable antigenicity. This implicates that the decreased immunogenicity of ecDNA-containing tumors was not caused by impaired antigenicity.</p>
<p>Antigen presentation efficiency is another important determinant of tumor immunogenicity. Therefore, we first directly compared expression of MHC-I/MHC-II genes and related biosynthetic genes between samples with and without ecDNA:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tpm_gene_log2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../../tmp/tpm_gene_log2.rds&quot;</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene_log2 <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gene <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;HLA-DQB1&quot;</span>,<span class="st">&quot;HLA-DRB1&quot;</span>,<span class="st">&quot;HLA-DQA1&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;HLA-DRB5&quot;</span>,<span class="st">&quot;HLA-DRA&quot;</span>,<span class="st">&quot;HLA-C&quot;</span>,<span class="st">&quot;HLA-A&quot;</span>,<span class="st">&quot;HLA-DPB1&quot;</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;HLA-DPA1&quot;</span>,<span class="st">&quot;HLA-DQB2&quot;</span>,<span class="st">&quot;HLA-B&quot;</span>,<span class="st">&quot;HLA-DQA2&quot;</span>,<span class="st">&quot;HLA-DOA&quot;</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;HLA-DMA&quot;</span>,<span class="st">&quot;HLA-DPB2&quot;</span>,<span class="st">&quot;HLA-DRB6&quot;</span>,<span class="st">&quot;HLA-DOB&quot;</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;HLA-DMB&quot;</span>,<span class="st">&quot;HLA-E&quot;</span>,<span class="st">&quot;HLA-F&quot;</span>,<span class="st">&quot;HLA-G&quot;</span>,<span class="st">&quot;HLA-H&quot;</span>,<span class="st">&quot;CIITA&quot;</span>,<span class="st">&quot;HSPH1&quot;</span>,<span class="st">&quot;IFNL1&quot;</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;IL33&quot;</span>,<span class="st">&quot;NLRC5&quot;</span>,<span class="st">&quot;NLRP12&quot;</span>,<span class="st">&quot;AZU1&quot;</span>,<span class="st">&quot;CIITA&quot;</span>,<span class="st">&quot;IFNG&quot;</span>,<span class="st">&quot;IL10&quot;</span>,<span class="st">&quot;IL33&quot;</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;IL4&quot;</span>,<span class="st">&quot;JAK2&quot;</span>,<span class="st">&quot;SIRT1&quot;</span>,<span class="st">&quot;TLR4&quot;</span>,<span class="st">&quot;TMEM106A&quot;</span>,<span class="st">&quot;XBP1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gene,<span class="fu">any_of</span>(dt<span class="sc">$</span>sample_barcode))</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tpm_gene) <span class="ot">&lt;-</span> tpm_gene<span class="sc">$</span>gene</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>gene)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> <span class="fu">t</span>(tpm_gene) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>sample <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tpm_gene)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>CIITA_1 <span class="ot">&lt;-</span> tpm_gene<span class="sc">$</span>CIITA</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>IL33_1 <span class="ot">&lt;-</span> tpm_gene<span class="sc">$</span>IL33</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tpm_gene,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                    dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode))</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_sample=</span><span class="fu">n</span>(),</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">ecDNA_postive=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="ot">-&gt;</span> tpm_summ</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>tpm_summ <span class="ot">&lt;-</span> tpm_summ <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(total_sample))</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>need_cancer <span class="ot">&lt;-</span> tpm_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ecDNA_postive <span class="sc">&gt;</span> <span class="dv">20</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>need_cancer <span class="ot">&lt;-</span> need_cancer<span class="sc">$</span>cancer</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> need_cancer)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;CIITA_1&quot;</span>,<span class="st">&quot;IL33_1&quot;</span>),<span class="fu">everything</span>())</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_dt <span class="sc">%&gt;%</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">&quot;CIITA_1&quot;</span><span class="sc">:</span><span class="st">&quot;HLA-DMB&quot;</span>,<span class="at">names_to =</span> <span class="st">&quot;gene&quot;</span>,<span class="at">values_to =</span> <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>exp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(tpm_dt<span class="sc">$</span>exp)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">get_cancer_type</span>(tpm_dt<span class="sc">$</span>sample)</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">factor</span>(tpm_dt<span class="sc">$</span>gene,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;HLA-A&quot;</span>,<span class="st">&quot;HLA-B&quot;</span>,<span class="st">&quot;HLA-C&quot;</span>,<span class="st">&quot;HLA-E&quot;</span>,<span class="st">&quot;HLA-F&quot;</span>,<span class="st">&quot;HLA-G&quot;</span>,<span class="st">&quot;HLA-H&quot;</span>,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;HLA-DQB1&quot;</span>,<span class="st">&quot;HLA-DRB1&quot;</span>,<span class="st">&quot;HLA-DQA1&quot;</span>,</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;HLA-DRB5&quot;</span>,<span class="st">&quot;HLA-DRA&quot;</span>,<span class="st">&quot;HLA-DPB1&quot;</span>,</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;HLA-DPA1&quot;</span>,<span class="st">&quot;HLA-DQB2&quot;</span>,<span class="st">&quot;HLA-DQA2&quot;</span>,<span class="st">&quot;HLA-DOA&quot;</span>,</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;HLA-DMA&quot;</span>,<span class="st">&quot;HLA-DPB2&quot;</span>,<span class="st">&quot;HLA-DRB6&quot;</span>,<span class="st">&quot;HLA-DOB&quot;</span>,</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;HLA-DMB&quot;</span>,<span class="st">&quot;CIITA&quot;</span>,<span class="st">&quot;HSPH1&quot;</span>,<span class="st">&quot;IFNL1&quot;</span>,</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;IL33&quot;</span>,<span class="st">&quot;NLRC5&quot;</span>,<span class="st">&quot;NLRP12&quot;</span>,<span class="st">&quot;AZU1&quot;</span>,<span class="st">&quot;IFNG&quot;</span>,<span class="st">&quot;IL10&quot;</span>,</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;IL4&quot;</span>,<span class="st">&quot;JAK2&quot;</span>,<span class="st">&quot;SIRT1&quot;</span>,<span class="st">&quot;TLR4&quot;</span>,<span class="st">&quot;TMEM106A&quot;</span>,<span class="st">&quot;XBP1&quot;</span>,<span class="st">&quot;CIITA_1&quot;</span>,<span class="st">&quot;IL33_1&quot;</span>))</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>tpm_dt,<span class="fu">aes</span>(<span class="at">x=</span>gene,<span class="at">y=</span>exp,<span class="at">fill=</span>ecDNA))<span class="sc">+</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;log2(TPM + 0.001)&quot;</span>)<span class="sc">+</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span>F)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-16-1.png" width="5100" style="display: block; margin: auto;" /></p>
<p>We also checked the cancer type specific MHC-I/II and related genes expression difference, heatmap color indicates median difference of expression for specific gene in specific cancer type between ecDNA and non-ecDNA samples:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">37</span><span class="sc">*</span><span class="dv">7</span>),<span class="at">nrow =</span> <span class="dv">37</span>,<span class="at">ncol =</span> <span class="dv">7</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> need_cancer</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mat)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>mat<span class="sc">$</span>gene <span class="ot">&lt;-</span> <span class="fu">levels</span>(tpm_dt<span class="sc">$</span>gene)[<span class="dv">1</span><span class="sc">:</span><span class="dv">37</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>CIITA_1,<span class="sc">-</span>IL33_1)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>cancer <span class="ot">&lt;-</span> <span class="fu">get_cancer_type</span>(tpm_gene<span class="sc">$</span>sample)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tpm_gene,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                      dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(mat)[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(mat)<span class="sc">-</span><span class="dv">1</span>)]){</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> mat<span class="sc">$</span>gene){</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(j,cancer,ecDNA) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(cancer <span class="sc">==</span> i)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;tt&quot;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>tt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>tt)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    mat[mat<span class="sc">$</span>gene <span class="sc">==</span> j,i] <span class="ot">&lt;-</span> <span class="fu">median</span>(df[df<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>,<span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">median</span>(df[df<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;no&quot;</span>,<span class="dv">1</span>])</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> mat<span class="sc">$</span>gene</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> mat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>gene)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(circlize)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>col_fun <span class="ot">=</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(mat,<span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,<span class="at">name =</span> <span class="st">&quot; &quot;</span>,<span class="at">col =</span> col_fun,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">row_split =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;MHC-I&quot;</span>),<span class="dv">7</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;MHC-II&quot;</span>),<span class="dv">15</span>),</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;MHC-I_BIOSYNTHETIC&quot;</span>),<span class="dv">6</span>),<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;MHC-II_BIOSYNTHETIC&quot;</span>),<span class="dv">9</span>))</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#&gt; Warning: The input is a data frame, convert it to the matrix.</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-17-1.png" width="1800" style="display: block; margin: auto;" /></p>
<p>In tumors with ecDNA significantly decreased MHC I genes’ expression is observed, the expression of MHC II genes are even more significantly down-regulated in tumors with ecDNA.</p>
<p>We further quantified the MHC-I/II antigen processing and presentation pathway activities by GSVA, and compared the GSVA values between samples with and without ecDNA:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">###gsva score caculate code can be found in code/gsva.R</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>GSVA <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/GSVA_pathway.rds&quot;</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>gsva <span class="ot">&lt;-</span> <span class="fu">t</span>(GSVA) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gsva) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GO MHC-I&quot;</span>,<span class="st">&quot;GO MHC-II&quot;</span>,<span class="st">&quot;REACTOME MHC-I&quot;</span>,<span class="st">&quot;REACTOME MHC-II&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>gsva<span class="sc">$</span>sample <span class="ot">&lt;-</span> <span class="fu">rownames</span>(gsva)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>gsva <span class="ot">&lt;-</span> <span class="fu">left_join</span>(gsva,dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>gsva_l <span class="ot">&lt;-</span> gsva <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">&quot;GO MHC-I&quot;</span><span class="sc">:</span><span class="st">&quot;REACTOME MHC-II&quot;</span>,<span class="at">names_to =</span> <span class="st">&quot;type&quot;</span>,<span class="at">values_to =</span> <span class="st">&quot;score&quot;</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>gsva_l <span class="ot">&lt;-</span> gsva_l <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ecDNA =</span> <span class="fu">ifelse</span>(ecDNA <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>,<span class="st">&quot;Non-ecDNA&quot;</span>))</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>gsva_l<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">factor</span>(gsva_l<span class="sc">$</span>ecDNA,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>gsva_l,<span class="fu">aes</span>(<span class="at">x=</span>type,<span class="at">y=</span>score,<span class="at">fill=</span>ecDNA))<span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;GSVA Score&quot;</span>)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-18-1.png" width="3000" style="display: block; margin: auto;" /></p>
<p>We also calculated pathway activities using GSEA. Firstly, Deseq2 was used to identify differential expressed genes between samples with and without ecDNA in specific cancer types and then applied GSEA to quantify pathway activities. Colors in the heatmap indicate ES scores in 6 type of cancers with at least 20 tumors with ecDNA, and values in heatmap cells indicates FDR corrected p values.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>res_gsea <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/res_gsea.rds&quot;</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>gsea_res <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(res_gsea,<span class="at">.id =</span> <span class="st">&quot;cancers&quot;</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>gsea_res <span class="ot">&lt;-</span> gsea_res <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cancers,pathway,ES,pval) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pathway=</span><span class="fu">case_when</span>(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    pathway <span class="sc">==</span> <span class="st">&quot;GOBP_ANTIGEN_PROCESSING_AND_PRESENTATION_OF_PEPTIDE_ANTIGEN_VIA_MHC_CLASS_I&quot;</span> <span class="sc">~</span> <span class="st">&quot;GO MHC-I&quot;</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    pathway <span class="sc">==</span> <span class="st">&quot;GOBP_ANTIGEN_PROCESSING_AND_PRESENTATION_OF_PEPTIDE_OR_POLYSACCHARIDE_ANTIGEN_VIA_MHC_CLASS_II&quot;</span> <span class="sc">~</span> <span class="st">&quot;GO MHC-II&quot;</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    pathway <span class="sc">==</span> <span class="st">&quot;REACTOME_CLASS_I_MHC_MEDIATED_ANTIGEN_PROCESSING_PRESENTATION&quot;</span> <span class="sc">~</span> <span class="st">&quot;REACTOME MHC-I&quot;</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    pathway <span class="sc">==</span> <span class="st">&quot;REACTOME_MHC_CLASS_II_ANTIGEN_PRESENTATION&quot;</span> <span class="sc">~</span> <span class="st">&quot;REACTOME MHC-II&quot;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>gsea_res<span class="sc">$</span>padj <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(gsea_res<span class="sc">$</span>pval,<span class="at">method =</span> <span class="st">&quot;fdr&quot;</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>gsea_res <span class="ot">&lt;-</span> gsea_res <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>pval)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>gsea_res <span class="ot">&lt;-</span> gsea_res <span class="sc">%&gt;%</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ES=</span><span class="fu">ifelse</span>(padj <span class="sc">&gt;</span> <span class="fl">0.05</span>,<span class="cn">NA</span>,ES))</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> gsea_res <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>ES)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>P<span class="sc">$</span>padj  <span class="ot">&lt;-</span> <span class="fu">format</span>(P<span class="sc">$</span>padj,<span class="at">digits=</span><span class="dv">3</span>,<span class="at">scientific =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>ES <span class="ot">&lt;-</span> gsea_res <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>padj)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>ES<span class="sc">$</span>ES <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(ES<span class="sc">$</span>ES,<span class="at">digits=</span><span class="dv">3</span>))</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> P <span class="sc">%&gt;%</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cancers,<span class="at">values_from =</span> padj) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>ES <span class="ot">&lt;-</span> ES <span class="sc">%&gt;%</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cancers,<span class="at">values_from =</span> ES) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(P) <span class="ot">&lt;-</span> P<span class="sc">$</span>pathway</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> P <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>pathway)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ES) <span class="ot">&lt;-</span> ES<span class="sc">$</span>pathway</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>ES <span class="ot">&lt;-</span> ES <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>pathway)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(circlize)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>col_fun <span class="ot">=</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.8</span>, <span class="fl">2.3</span>), <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(ES,<span class="at">cluster_rows =</span> F,<span class="at">cluster_columns =</span> F,<span class="at">name =</span> <span class="st">&quot;ES&quot;</span>,<span class="at">column_names_side=</span><span class="st">&quot;top&quot;</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na_col =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cell_fun =</span> <span class="cf">function</span>(j, i, x, y, w, h, col) { <span class="co"># add text to each grid</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">grid.text</span>(P[i, j], x, y)</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>                        })</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-19-1.png" width="2400" /></p>
<p>The impaired expression of MHC I and II could be the mechanism underlying decreased immune infiltration in tumors with ecDNA.</p>
<p>The presence of ecDNA has been shown to promote tumor heterogeneity through unequal ecDNA segregation during cell division. Tumor heterogeneity status has been quantified based on the variation level of VAF:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">##MATH calculation code can be found in code/math.R</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>MATH <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/TCGA_MATH_Value.rds&quot;</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(MATH) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;MATH_Value&quot;</span>,<span class="st">&quot;sample_barcode&quot;</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>dt_math <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(MATH,dt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample_barcode=</span><span class="fu">substr</span>(sample_barcode,<span class="dv">1</span>,<span class="dv">12</span>)))</span></code></pre></div>
<pre><code>#&gt; Joining, by = &quot;sample_barcode&quot;</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dt_math <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">c=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(c<span class="sc">&gt;</span><span class="dv">20</span>) <span class="ot">-&gt;</span> summ</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>dt_math <span class="ot">&lt;-</span> dt_math <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> summ<span class="sc">$</span>cancer)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>dt_math <span class="ot">&lt;-</span> dt_math <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ecDNA =</span> <span class="fu">ifelse</span>(ecDNA <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>,<span class="st">&quot;Non-ecDNA&quot;</span>))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>dt_math<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">factor</span>(dt_math<span class="sc">$</span>ecDNA,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>dt_math<span class="sc">$</span>MATH_Value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dt_math<span class="sc">$</span>MATH_Value)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dt_math,<span class="fu">aes</span>(<span class="at">x=</span>cancer,<span class="at">y=</span><span class="fu">log</span>(MATH_Value<span class="sc">+</span><span class="dv">1</span>),<span class="at">fill=</span>ecDNA))<span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) )<span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;log(MATH + 1)&quot;</span>,<span class="at">x=</span> <span class="cn">NULL</span>,<span class="at">title =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-20-1.png" width="2400" /></p>
<p>Tumors with ecDNA show significantly up-regulated heterogeneity level. The up-regulated tumor heterogeneity could be another mechanism to promote tumor immune evasion. The presence of ecDNA is associated with increased tumor heterogeneity, decreased antigen presentation gene expression, leads to impaired tumor immunogenicity.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">##cGAS-STING </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>tpm_gene_log2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../../tmp/tpm_gene_log2.rds&quot;</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene_log2 <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gene <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;XRCC5&quot;</span>, <span class="st">&quot;IRF3&quot;</span>, <span class="st">&quot;TRIM21&quot;</span>, <span class="st">&quot;IFI16&quot;</span>, <span class="st">&quot;STAT6&quot;</span>, <span class="st">&quot;NLRC3&quot;</span>, <span class="st">&quot;DDX41&quot;</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;TBK1&quot;</span>, <span class="st">&quot;XRCC6&quot;</span>, <span class="st">&quot;TREX1&quot;</span>, <span class="st">&quot;PRKDC&quot;</span>, <span class="st">&quot;MB21D1&quot;</span>, <span class="st">&quot;TMEM173&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gene,<span class="fu">any_of</span>(dt<span class="sc">$</span>sample_barcode))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tpm_gene) <span class="ot">&lt;-</span> tpm_gene<span class="sc">$</span>gene</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> tpm_gene <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>gene)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>tpm_gene <span class="ot">&lt;-</span> <span class="fu">t</span>(tpm_gene) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>tpm_gene<span class="sc">$</span>sample <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tpm_gene)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tpm_gene,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                    dt <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sample=</span>sample_barcode))</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cancer) <span class="sc">%&gt;%</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_sample=</span><span class="fu">n</span>(),</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">ecDNA_postive=</span><span class="fu">sum</span>(ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>)) <span class="ot">-&gt;</span> tpm_summ</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>tpm_summ <span class="ot">&lt;-</span> tpm_summ <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(total_sample))</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>need_cancer <span class="ot">&lt;-</span> tpm_summ <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ecDNA_postive <span class="sc">&gt;</span> <span class="dv">20</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>need_cancer <span class="ot">&lt;-</span> need_cancer<span class="sc">$</span>cancer</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cancer <span class="sc">%in%</span> need_cancer)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>tpm_dt <span class="ot">&lt;-</span> tpm_dt <span class="sc">%&gt;%</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">&quot;XRCC5&quot;</span><span class="sc">:</span><span class="st">&quot;PRKDC&quot;</span>,<span class="at">names_to =</span> <span class="st">&quot;gene&quot;</span>,<span class="at">values_to =</span> <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>exp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(tpm_dt<span class="sc">$</span>exp)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tpm_dt<span class="sc">$</span>ecDNA<span class="sc">==</span><span class="st">&quot;yes&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>,<span class="st">&quot;Non-ecDNA&quot;</span>)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>tpm_dt<span class="sc">$</span>ecDNA <span class="ot">&lt;-</span> <span class="fu">factor</span>(tpm_dt<span class="sc">$</span>ecDNA,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Non-ecDNA&quot;</span>,<span class="st">&quot;ecDNA&quot;</span>))</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>tpm_dt,<span class="fu">aes</span>(<span class="at">x=</span>gene,<span class="at">y=</span>exp,<span class="at">fill=</span>ecDNA))<span class="sc">+</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..p.signif..))<span class="sc">+</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_prism</span>()<span class="sc">+</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;log2(TPM + 0.001)&quot;</span>)<span class="sc">+</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="analysis_files/figure-html/unnamed-chunk-21-1.png" width="2400" /></p>
<p>Cytoplasmic DNA is known to stimulate immune response through cGAS-STING pathway, and in tumors with ecDNA, this pathway is not over-activated.</p>
</div>
</div>

   
   
            
      

  <script>
    $(document).ready(function () {

			
 		
	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
